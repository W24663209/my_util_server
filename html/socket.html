<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/jquery-3.6.1.min.js"></script>
</head>
<body>
<div id="time"
     style="width: 300px;height: 50px;  text-align: center;line-height: 50px;margin-left: 40%;font-size: 20px"></div>
<script>
    let interval = undefined
    let reconnect = 20
    let connecting = false //连接中
    init()

    function init() {
        let ws = new WebSocket("ws://127.0.0.1:8765/");  //连接server

        ws.onmessage = function (event) {
            let content = document.createTextNode(event.data); // 接收数据
            console.log(content)
            $("#time").html(content);
        };

        ws.onerror = function (event) {
            console.log('onerror')
        }
        ws.onopen = function (event) {
            console.log('onopen')
            clearInterval(interval)
            connecting = false
        }

        ws.onclose = function (event) {
            console.log('onclose')
            if (!connecting) {
                interval = setInterval(function () {
                    connecting = true
                    init()
                    reconnect--
                }, 3000);
            }
        }
    }
</script>
</body>
</html>